<!DOCTYPE html>

<html>
<head>
<title>HTML5 Ajax file--UPLOAD</title>


<script type="text/javascript">
function setfile() {
    var fd = new FormData();
    var pic = document.getElementsByTagName('input')[0].files[0];
    fd.append('pic',pic);
    console.log(pic);
    
    var cont = '';
    cont += '文件名称:' + pic.name + '<br/>';
    cont += '文件大小:' + pic.size + '<br/>';
    
    
    
    
    var xhr = new XMLHttpRequest();
    xhr.open('POST','html5up.php',true);
    
    //监听函数，显示上传的图片对象到浏览器中；
    xhr.onreadystatechange = function(){
        if (this.readyState == 4 && this.status == 200) {
            document.getElementById('debug').innerHTML = this.responseText + '<br/>' + cont;
            
            //把二进制对象直接读成浏览器显示的资源，注意<img>不能使用file://协议
            var tmpimg = document.createElement('img');
            tmpimg.src = window.URL.createObjectURL(pic);
            document.getElementsByTagName('body')[0].appendChild(tmpimg);
            
        }
    }
    
    //利用XHR2的新标准，为上传过程写一个监听函数
    xhr.upload.onprogress = function (ev) {
        if (ev.lengthComputable) {
            console.log(ev);
            var percent = 100*ev.loaded/ev.total;
            console.log(percent);
            document.getElementById('bar').style.width = percent+'%';
            document.getElementById('bar').innerHTML=parseInt(percent) + '%';
        }
    }
    
    xhr.send(fd);
}
</script>
<style type="text/css">
    #progress {
        width: 500px;
        height: 30px;
        border: 1px solid green;
    }
    
    #bar {
        background: green;
        height: 100%;
        width: 0%;
    }
</style>


</head>
<body>
<h1>HTML5文件上传</h1>
<div id="progress">
    <div id="bar"></div>
</div>
<input type="file" name="pic" onchange="setfile();" />
<div id="debug"></div>
</body>
</html>